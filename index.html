<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Affiliate AI Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .loader { border: 3px solid #334155; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons
        const IconSparkles = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>;
        const IconImage = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>;
        const IconVideo = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>;
        const IconPlay = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const IconUpload = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const IconMic = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>;

        const apiKey = ""; // API Key ‡∏à‡∏≤‡∏Å Google AI Studio ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ñ‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ)

        // Helper: Fetch API ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö Retry
        const fetchWithRetry = async (url, options, retries = 5) => {
            const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, options);
                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                    return await res.json();
                } catch (error) {
                    // ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô Error 429 ‡πÉ‡∏´‡πâ Throw ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ Retry ‡∏ã‡πâ‡∏≥‡πÑ‡∏õ‡∏ã‡πâ‡∏≥‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏ô‡πÅ‡∏ö‡∏ô
                    if (error.message.includes('429') || i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delays[i]));
                }
            }
        };

        const App = () => {
            const [storyPrompt, setStoryPrompt] = useState("‡πÄ‡∏ã‡∏£‡∏±‡πà‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‡∏ó‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏â‡πà‡∏≥‡∏ß‡∏≤‡∏ß ‡∏•‡∏î‡∏£‡∏≠‡∏¢‡∏™‡∏¥‡∏ß");
            const [scenes, setScenes] = useState([]);
            const [status, setStatus] = useState("idle"); 
            const [errorMsg, setErrorMsg] = useState("");
            
            // Settings
            const [aspectRatio, setAspectRatio] = useState("9:16");
            const [tone, setTone] = useState("‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô ‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤‡∏´‡∏ô‡∏±‡∏Å‡πÜ");
            const [videoMode, setVideoMode] = useState("affiliate");
            const [productImageBase64, setProductImageBase64] = useState(null);
            const [productImagePreview, setProductImagePreview] = useState(null);

            // Copy to clipboard helper
            const handleCopy = (text) => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                } catch (err) {
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textarea);
            };

            // Image Upload Handler
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setProductImagePreview(URL.createObjectURL(file));
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setProductImageBase64(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // 1. Generate Script (Gemini)
            const generateScript = async () => {
                if (!storyPrompt.trim()) return;
                setStatus("scripting");
                setErrorMsg("");
                setScenes([]);

                const modeInstruction = videoMode === 'affiliate' 
                    ? `‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå: ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏ß‡∏õ‡∏±‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (TikTok Affiliate)
                    **‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÇ‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏Ñ‡∏•‡∏°‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î, ‡∏Ç‡∏≤‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ, ‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏ß, ‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏• 100%, ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î) ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ú‡∏¥‡∏î‡∏Å‡∏é TikTok ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏î‡∏π‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏à‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏µ‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡πÜ`
                    : `‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå: ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ / ‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á (Educational / Channel Growth)
                    **‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡πÄ‡∏ô‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤ ‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à ‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏ô‡∏∏‡∏Å ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏µ‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î ‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô Call to Action ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏ù‡∏≤‡∏Å‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à ‡∏Å‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô)`;

                const promptText = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏™‡∏±‡πâ‡∏ô (TikTok)
                ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: "${storyPrompt}"
                ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå/‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î: "${tone}"
                ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠: ${aspectRatio}
                
                ${modeInstruction}
                
                ${productImageBase64 ? '‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ö‡∏ó‡∏û‡∏π‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏†‡∏≤‡∏û' : ''}
                
                ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏â‡∏≤‡∏Å (‡∏â‡∏≤‡∏Å‡∏•‡∏∞ 8 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):
                ‡∏â‡∏≤‡∏Å‡∏ó‡∏µ‡πà 1: Hook (‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à/‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πâ‡∏ß‡πÇ‡∏õ‡πâ‡∏á)
                ‡∏â‡∏≤‡∏Å‡∏ó‡∏µ‡πà 2: Body/Review (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å/‡∏ö‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏î‡∏µ/‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ)
                ‡∏â‡∏≤‡∏Å‡∏ó‡∏µ‡πà 3: Call to Action (‡∏ä‡∏µ‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏≠‡∏á ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå)

                ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô JSON array ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ markdown ‡∏´‡∏∏‡πâ‡∏° ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ:
                [
                  {
                    "id": 1,
                    "duration": "8s",
                    "description_th": "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏†‡∏≤‡∏û (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)",
                    "voiceover_th": "‡∏ö‡∏ó‡∏û‡∏π‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏â‡∏≤‡∏Å‡∏ô‡∏µ‡πâ (‡∏û‡∏π‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏™‡πÑ‡∏ï‡∏•‡πå ${tone} ‡πÅ‡∏•‡∏∞‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î)",
                    "image_prompt_en": "Highly detailed english prompt for generating a beautiful high-quality starting image. ${aspectRatio === '9:16' ? 'Must specify vertical composition 9:16.' : ''} Include product details if an image was provided.",
                    "video_prompt_en": "English prompt for Flow AI/Luma video generation describing camera movement and subject motion"
                  }
                ]`;

                try {
                    const payloadParts = [{ text: promptText }];
                    
                    if (productImageBase64) {
                        const base64Data = productImageBase64.split(',')[1];
                        const mimeType = productImageBase64.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/)[1];
                        payloadParts.push({
                            inlineData: {
                                mimeType: mimeType,
                                data: base64Data
                            }
                        });
                    }

                    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô AI ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥: ‡∏ñ‡πâ‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Ñ‡∏µ‡∏¢‡πå‡∏ß‡πà‡∏≤‡∏á(‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ)‡πÉ‡∏ä‡πâ Preview, ‡∏ñ‡πâ‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á(‡∏£‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å)‡πÉ‡∏ä‡πâ 1.5-flash (‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î 404)
                    const modelName = apiKey ? "gemini-1.5-flash" : "gemini-2.5-flash-preview-09-2025"; 
                    
                    const result = await fetchWithRetry(
                        `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: payloadParts }],
                                generationConfig: {
                                    responseMimeType: "application/json"
                                }
                            })
                        }
                    );

                    let jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    const parsedScenes = JSON.parse(jsonText);
                    
                    const initializedScenes = parsedScenes.map(scene => ({
                        ...scene,
                        imageUrl: null,
                        isGeneratingImage: false,
                        videoUrl: null,
                        isGeneratingVideo: false,
                        videoProgress: 0
                    }));

                    setScenes(initializedScenes);
                    setStatus("ready");

                    // ‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏Å‡∏¥‡∏î Error 429)
                    for (let i = 0; i < initializedScenes.length; i++) {
                        generateImage(initializedScenes[i].id, initializedScenes[i].image_prompt_en);
                        // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 2.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏†‡∏≤‡∏û
                        await new Promise(resolve => setTimeout(resolve, 2500)); 
                    }

                } catch (error) {
                    console.error(error);
                    if (error.message.includes('429')) {
                        setErrorMsg("‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ (Error 429) - ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏Å‡∏î‡∏ñ‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö");
                    } else {
                        setErrorMsg("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key, ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)");
                    }
                    setStatus("idle");
                }
            };

            // 2. Generate Image (Imagen)
            const generateImage = async (id, imagePrompt) => {
                setScenes(prev => prev.map(s => s.id === id ? { ...s, isGeneratingImage: true } : s));
                
                try {
                    const result = await fetchWithRetry(
                        `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                instances: [{ prompt: imagePrompt }],
                                parameters: { 
                                    sampleCount: 1,
                                    aspectRatio: aspectRatio // ‡∏™‡πà‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô 9:16 ‡πÉ‡∏´‡πâ Imagen
                                }
                            })
                        }
                    );

                    const base64 = result.predictions?.[0]?.bytesBase64Encoded;
                    if (base64) {
                        const imageUrl = `data:image/png;base64,${base64}`;
                        setScenes(prev => prev.map(s => s.id === id ? { ...s, imageUrl, isGeneratingImage: false } : s));
                    } else {
                        throw new Error("No image data returned");
                    }
                } catch (error) {
                    console.error(error);
                    if (error.message.includes('429')) {
                        setScenes(prev => prev.map(s => s.id === id ? { ...s, isGeneratingImage: false, imageUrl: 'error_429' } : s));
                    } else {
                        setScenes(prev => prev.map(s => s.id === id ? { ...s, isGeneratingImage: false, imageUrl: 'error' } : s));
                    }
                }
            };

            // 3. Mock Video Generation (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠)
            const generateVideo = (id) => {
                setScenes(prev => prev.map(s => s.id === id ? { ...s, isGeneratingVideo: true, videoProgress: 0 } : s));
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress >= 100) {
                        clearInterval(interval);
                        setScenes(prev => prev.map(s => s.id === id ? { 
                            ...s, 
                            isGeneratingVideo: false, 
                            videoProgress: 100,
                            videoUrl: 'https://www.w3schools.com/html/mov_bbb.mp4' // ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á
                        } : s));
                    } else {
                        setScenes(prev => prev.map(s => s.id === id ? { ...s, videoProgress: progress } : s));
                    }
                }, 500);
            };

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8 space-y-8">
                    {/* Header */}
                    <header className="text-center space-y-4 pt-8 pb-4">
                        <div className="inline-flex items-center justify-center p-3 bg-blue-500/10 rounded-full mb-2">
                            <IconVideo className="w-8 h-8 text-blue-400" />
                        </div>
                        <h1 className="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
                            TikTok Affiliate AI Studio
                        </h1>
                        <p className="text-slate-400 max-w-2xl mx-auto">
                            ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏õ‡∏±‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏à‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Gemini Vision + Imagen ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏û‡∏π‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        </p>
                    </header>

                    {/* Input Section */}
                    <section className="glass rounded-2xl p-6 shadow-xl space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {/* Product Image Upload */}
                            <div className="col-span-1 space-y-2">
                                <label className="block text-sm font-medium text-slate-300">
                                    1. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                                </label>
                                <div className="relative h-24 bg-slate-800/50 border-2 border-dashed border-slate-600 rounded-xl flex items-center justify-center hover:border-blue-500 transition-colors cursor-pointer overflow-hidden">
                                    <input 
                                        type="file" 
                                        accept="image/*" 
                                        onChange={handleImageUpload} 
                                        className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" 
                                    />
                                    {productImagePreview ? (
                                        <img src={productImagePreview} alt="Product preview" className="w-full h-full object-cover opacity-60" />
                                    ) : (
                                        <div className="text-slate-400 flex flex-col items-center gap-1">
                                            <IconUpload />
                                            <span className="text-xs">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á</span>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Settings */}
                            <div className="col-span-1 md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="space-y-2">
                                    <label className="block text-sm font-medium text-slate-300">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ</label>
                                    <select 
                                        value={videoMode} 
                                        onChange={(e) => setVideoMode(e.target.value)}
                                        className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none cursor-pointer"
                                    >
                                        <option value="affiliate">üõí ‡∏õ‡∏±‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ñ‡∏≥‡πÄ‡∏Ñ‡∏•‡∏°)</option>
                                        <option value="educational">üí° ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ / ‡∏î‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á</option>
                                    </select>
                                </div>
                                <div className="space-y-2">
                                    <label className="block text-sm font-medium text-slate-300">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏≤‡∏û</label>
                                    <select 
                                        value={aspectRatio} 
                                        onChange={(e) => setAspectRatio(e.target.value)}
                                        className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none cursor-pointer"
                                    >
                                        <option value="9:16">9:16 (TikTok / Reels)</option>
                                        <option value="16:9">16:9 (YouTube ‡πÅ‡∏ô‡∏ß‡∏Ç‡∏ß‡∏≤‡∏á)</option>
                                        <option value="1:1">1:1 (Instagram)</option>
                                    </select>
                                </div>
                                <div className="space-y-2">
                                    <label className="block text-sm font-medium text-slate-300">‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (Tone)</label>
                                    <select 
                                        value={tone} 
                                        onChange={(e) => setTone(e.target.value)}
                                        className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none cursor-pointer"
                                    >
                                        <option value="‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô ‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤‡∏´‡∏ô‡∏±‡∏Å‡πÜ">ü§© ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô ‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤‡∏´‡∏ô‡∏±‡∏Å‡πÜ</option>
                                        <option value="‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ä‡∏¥‡∏•‡πÜ ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥">üçÉ ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ä‡∏¥‡∏•‡πÜ ‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥</option>
                                        <option value="‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏ô‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°">üìñ ‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏ô‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</option>
                                        <option value="‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠">üßê ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠</option>
                                        <option value="‡∏ï‡∏•‡∏Å‡∏Ç‡∏ö‡∏Ç‡∏±‡∏ô ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ">üòÇ ‡∏ï‡∏•‡∏Å‡∏Ç‡∏ö‡∏Ç‡∏±‡∏ô ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-2">
                            <label className="block text-sm font-medium text-slate-300">
                                2. ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≠‡∏Å AI ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£ / ‡∏ö‡∏£‡∏µ‡∏ü‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
                            </label>
                            <div className="flex gap-4 flex-col md:flex-row">
                                <textarea 
                                    value={storyPrompt}
                                    onChange={(e) => setStoryPrompt(e.target.value)}
                                    className="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                                    rows="3"
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ã‡∏£‡∏±‡πà‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‡∏ó‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏â‡πà‡∏≥‡∏ß‡∏≤‡∏ß ‡∏•‡∏î‡∏£‡∏≠‡∏¢‡∏™‡∏¥‡∏ß..."
                                />
                                <button 
                                    onClick={generateScript}
                                    disabled={status === "scripting" || !storyPrompt.trim()}
                                    className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-4 px-8 rounded-xl shadow-lg shadow-blue-500/20 transition-all flex items-center justify-center gap-2 h-auto md:w-48 whitespace-nowrap"
                                >
                                    {status === "scripting" ? (
                                        <><div className="loader w-5 h-5 border-2 border-white/30 border-t-white"></div> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå...</>
                                    ) : (
                                        <><IconSparkles /> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡πÄ‡∏•‡∏¢</>
                                    )}
                                </button>
                            </div>
                        </div>
                        {errorMsg && <p className="text-amber-400 mt-3 text-sm font-medium p-3 bg-amber-400/10 rounded-lg border border-amber-400/20">{errorMsg}</p>}
                    </section>

                    {/* Scenes Display */}
                    {scenes.length > 0 && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {scenes.map((scene, index) => (
                                <div key={scene.id} className="glass rounded-2xl overflow-hidden flex flex-col transform transition-all hover:-translate-y-1">
                                    
                                    {/* Header */}
                                    <div className="bg-slate-800/80 p-4 border-b border-slate-700 flex justify-between items-center">
                                        <h3 className="font-bold text-lg text-white flex items-center gap-2">
                                            <span className="bg-blue-500 text-xs px-2 py-1 rounded-md">
                                                {scene.id === 1 ? '‡∏â‡∏≤‡∏Å‡∏ó‡∏µ‡πà 1 : Hook' : scene.id === 2 ? '‡∏â‡∏≤‡∏Å‡∏ó‡∏µ‡πà 2 : Review' : '‡∏â‡∏≤‡∏Å‡∏ó‡∏µ‡πà 3 : CTA (‡∏õ‡∏±‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤)'}
                                            </span>
                                        </h3>
                                        <span className="text-xs font-mono text-slate-400 bg-slate-900 px-2 py-1 rounded">‚è± {scene.duration}</span>
                                    </div>

                                    {/* Content */}
                                    <div className="p-5 flex-1 space-y-5">
                                        <div className="space-y-3">
                                            <div className="bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                                                <h4 className="text-xs font-semibold text-slate-400 mb-1 flex items-center gap-1"><IconImage /> ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô</h4>
                                                <p className="text-sm text-slate-300 leading-relaxed">
                                                    {scene.description_th}
                                                </p>
                                            </div>
                                            <div className="bg-blue-900/20 p-3 rounded-lg border border-blue-900/50 relative group">
                                                <h4 className="text-xs font-semibold text-blue-400 mb-1 flex items-center gap-1"><IconMic /> ‡∏ö‡∏ó‡∏û‡∏π‡∏î (Voiceover)</h4>
                                                <p className="text-sm text-blue-100 leading-relaxed font-medium">
                                                    "{scene.voiceover_th}"
                                                </p>
                                                <button onClick={() => handleCopy(scene.voiceover_th)} className="absolute right-2 top-2 text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"><IconCopy /></button>
                                            </div>
                                        </div>

                                        {/* Image Section */}
                                        <div className="space-y-2">
                                            <div className="flex justify-between items-end">
                                                <label className="text-xs font-semibold text-slate-400 uppercase tracking-wider flex items-center gap-1">
                                                    <IconImage /> ‡∏†‡∏≤‡∏û‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô (Imagen)
                                                </label>
                                            </div>
                                            <div className={`relative bg-slate-800 rounded-xl overflow-hidden group border border-slate-700 mx-auto ${aspectRatio === '9:16' ? 'aspect-[9/16] max-w-[220px]' : aspectRatio === '1:1' ? 'aspect-square max-w-[280px]' : 'aspect-video w-full'}`}>
                                                {scene.isGeneratingImage ? (
                                                    <div className="absolute inset-0 flex flex-col items-center justify-center gap-3">
                                                        <div className="loader"></div>
                                                        <span className="text-xs text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û...</span>
                                                    </div>
                                                ) : scene.imageUrl === 'error_429' ? (
                                                    <div className="absolute inset-0 flex items-center justify-center text-xs text-amber-400 text-center p-3 bg-amber-400/10">
                                                        ‚ö†Ô∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß<br/>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (Error 429) ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà
                                                    </div>
                                                ) : scene.imageUrl === 'error' ? (
                                                    <div className="absolute inset-0 flex items-center justify-center text-xs text-red-400 text-center p-2">
                                                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß<br/>(‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß‡∏†‡∏≤‡∏û)
                                                    </div>
                                                ) : scene.imageUrl ? (
                                                    <img src={scene.imageUrl} alt="Scene start frame" className="w-full h-full object-cover" />
                                                ) : null}
                                            </div>
                                            <div className="bg-slate-900/50 p-2 rounded-lg group relative cursor-pointer hover:bg-slate-900" onClick={() => handleCopy(scene.image_prompt_en)} title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Prompt">
                                                <p className="text-[10px] text-slate-500 font-mono line-clamp-2 pr-6">{scene.image_prompt_en}</p>
                                                <button className="absolute right-2 top-2 text-slate-600 group-hover:text-white transition-colors"><IconCopy /></button>
                                            </div>
                                        </div>

                                        <hr className="border-slate-700" />

                                        {/* Video Section */}
                                        <div className="space-y-3">
                                            <div className="flex justify-between items-end">
                                                <label className="text-xs font-semibold text-slate-400 uppercase tracking-wider flex items-center gap-1">
                                                    <IconVideo /> ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (Flow AI)
                                                </label>
                                            </div>
                                            
                                            <div className="bg-slate-900/50 p-2 rounded-lg group relative cursor-pointer hover:bg-slate-900" onClick={() => handleCopy(scene.video_prompt_en)} title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Prompt ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Video">
                                                <p className="text-[10px] text-slate-500 font-mono line-clamp-2 pr-6">üé¨ Motion: {scene.video_prompt_en}</p>
                                                <button className="absolute right-2 top-2 text-slate-600 group-hover:text-white transition-colors"><IconCopy /></button>
                                            </div>

                                            {!scene.videoUrl && !scene.isGeneratingVideo && (
                                                <button 
                                                    onClick={() => generateVideo(scene.id)}
                                                    disabled={!scene.imageUrl || scene.isGeneratingImage || scene.imageUrl.includes('error')}
                                                    className="w-full bg-indigo-600/20 hover:bg-indigo-600/40 text-indigo-300 border border-indigo-500/30 py-2.5 rounded-xl text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                                >
                                                    <IconSparkles className="w-4 h-4" /> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (Flow AI)
                                                </button>
                                            )}

                                            {scene.isGeneratingVideo && (
                                                <div className="space-y-2 p-3 bg-slate-800 rounded-xl border border-slate-700">
                                                    <div className="flex justify-between text-xs text-slate-400">
                                                        <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠...</span>
                                                        <span>{Math.round(scene.videoProgress)}%</span>
                                                    </div>
                                                    <div className="h-1.5 w-full bg-slate-900 rounded-full overflow-hidden">
                                                        <div className="h-full bg-indigo-500 progress-bar rounded-full relative overflow-hidden" style={{ width: `${scene.videoProgress}%` }}>
                                                            <div className="absolute inset-0 bg-white/20" style={{ animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite' }}></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {scene.videoUrl && (
                                                <div className={`relative bg-black rounded-xl overflow-hidden border border-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.2)] mx-auto ${aspectRatio === '9:16' ? 'aspect-[9/16] max-w-[220px]' : aspectRatio === '1:1' ? 'aspect-square max-w-[280px]' : 'aspect-video w-full'}`}>
                                                    <video 
                                                        src={scene.videoUrl} 
                                                        className="w-full h-full object-cover opacity-80" 
                                                        autoPlay 
                                                        loop 
                                                        muted
                                                    />
                                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                                        <div className="bg-black/50 p-3 rounded-full backdrop-blur-sm text-white">
                                                            <IconPlay />
                                                        </div>
                                                    </div>
                                                    <div className="absolute top-2 left-2 bg-indigo-600 text-white text-[10px] px-2 py-0.5 rounded shadow">
                                                        Gen: Flow AI
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
